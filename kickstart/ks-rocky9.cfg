%pre
#!/bin/sh
echo "pkr_name=$PKR_NAME" > /tmp/envvars
echo "pkr_pwd_crypted=$PKR_PWD" > /tmp/envvars
%end

# Use graphical install
graphical
repo --name="minimal" --baseurl=file:///run/install/sources/mount-0000-cdrom/minimal

%addon com_redhat_kdump --disable

%end

# Keyboard layouts
keyboard --xlayouts='fr (oss)'
# System language
lang fr_FR.UTF-8

# Network information
network --bootproto=dhcp --device=ens18 --noipv6 --activate
network --hostname=rockytpl

# Use CDROM installation media
cdrom

%packages
@^minimal-environment
@guest-agents
bash-completion

%end

%include /tmp/envvars

# Run the Setup Agent on first boot
firstboot --enable

# Generated using Blivet version 3.4.0
ignoredisk --only-use=sda
# System bootloader configuration
bootloader --location=mbr --boot-drive=sda
# Partition clearing information
clearpart --none --initlabel
# Disk partitioning information
part pv.111 --fstype="lvmpv" --ondisk=sda --size=1 --grow
part /boot --fstype="xfs" --ondisk=sda --size=1024
volgroup vg_root pv.111
logvol swap --fstype="swap" --size=2047 --name=lv_swap --vgname=vg_root
logvol / --fstype="xfs" --percent=100 --name=lv_root --vgname=vg_root

# System timezone
timezone Europe/Paris --utc

#Root password
rootpw --lock
user --groups=wheel --name=${pkr_name} --password=${pkr_pwd_crypted} --iscrypted
sed -i 's/^%wheel/# %wheel/' /etc/sudoers
sed -i 's/^# %wheel\tALL=(ALL)\tNOPASSWD: ALL/%wheel\tALL=(ALL)\tNOPASSWD: ALL/' /etc/sudoers
